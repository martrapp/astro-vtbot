---
// Including this scipt directly in VtBotDebug.astro did not work for prettier
---

<script is:inline>
	(() => {
		const PREFIX = '[vtbot-debug]';
		const enabled = () => document.querySelector('meta[name="vtbot-debug"]');

		/*
		 * capture the original data of the eventsls
		 */
		const doCapture = (e) => {
			window._vtbot_debug.capture = {
				...e,
				type: e.type,
				cancelable: e.cancelable,
				defaultPrevented: e.defaultPrevented,
				event: e,
			};
		};
		const originalAddEventListener = EventTarget.prototype.addEventListener;
		/*
		EventTarget.prototype.addEventListener = function (eventName, eventHandler) {
			console.log(
				`${deriveCSSSelector(this)} ${eventName}: ${eventHandler.toString().substring(0, 100)}`
			);
			originalAddEventListener.call(this, eventName, eventHandler);
		};
*/
		/*
		 * capture the event properties at beginning of the processing phase
		 */
		const startProcessing = (e) => {
			doCapture(e);
			if (enabled()) {
				console.log(`%c${PREFIX}%c Event handler for ${e.type}`, 'color:#48f', '');
				window._vtbot_debug.active = 2;
			}
		};

		/*
		 * Register the two "early" handlers
		 */
		if (window._vtbot_debug === undefined) {
			window._vtbot_debug = {};
			document.addEventListener('astro:before-preparation', startProcessing);
			document.addEventListener('astro:before-swap', startProcessing);
		}
		// end of "early" part
	})();
</script>
