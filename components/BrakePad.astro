---
export interface Props {
	duration?: number;
	production?: boolean;
}
const TAG = 'vtbot-brake-pad'; // see also start of script
let { duration = 2000 } = Astro.props;
if (!(import.meta.env.DEV || Astro.props.production)) {
	duration = 0;
}
---

{duration > 0 && <meta name={TAG} content={'' + duration} />}

{ duration > 0 && <script type="module">
	const TAG = 'vtbot-brake-pad';
	const duration = () =>
		(document.querySelector(`meta[name="${TAG}"]`))?.content;

	const beforePreparation = (event) => {
		const waitTime = duration();

		if (waitTime) {
			const originalLoader = event.loader;
			event.loader = async () => {
				await originalLoader();
				await new Promise((resolve) => setTimeout(resolve, parseInt(waitTime, 10)));
			};
		}
	};
	document.addEventListener('astro:before-preparation', beforePreparation);
</script>}
